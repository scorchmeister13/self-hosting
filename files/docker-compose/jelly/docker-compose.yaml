---
services:
  # ðŸ”¹ðŸ”¹ JELLYFIN  ðŸ”¹ðŸ”¹
  # Media player
  jellyfin:
    image: lscr.io/linuxserver/jellyfin:latest
    container_name: jellyfin
    environment:
      - JELLYFIN_PublishedServerUrl=http://jellyfin.{{ domain }}
      - PGID=0
      - PUID=0
      - TZ={{ timezone }}
    volumes:
      - ./jellyfin/config:/config
      - ./jellyfin/cache:/cache
      - /mnt/media/disk-0/movies:/movies
      - /mnt/media/disk-0/tv:/tv
      - /mnt/media/disk-0/youtube:/youtube
    devices:
      - "/dev/dri:/dev/dri"
    restart: 'unless-stopped'
    ports:
      - "7359:7359/udp"  # Client Discovery
    labels:
      # Traefik
      - "traefik.docker.network=proxy"
      - "traefik.enable=true"
      # HTTP ROUTER
      - "traefik.http.routers.jellyfin.entrypoints=web"
      - "traefik.http.routers.jellyfin.rule=Host(`jellyfin.{{ domain }}`)"
      - "traefik.http.routers.jellyfin.service=jellyfin"
      - "traefik.http.services.jellyfin.loadbalancer.server.port=8096"
      # HTTPS ROUTER
      # - "traefik.http.routers.jellyfin.entrypoints=websecure"
      # - "traefik.http.routers.jellyfin.rule=Host(`jellyfin.{{ domain }}`)"
      # - "traefik.http.routers.jellyfin.tls=true"
      # - "traefik.http.routers.jellyfin.tls.certresolver=stepca"
      # - "traefik.http.services.jellyfin.loadbalancer.server.port=8096"
    networks:
      - default
      - proxy

  # ðŸ”¹ðŸ”¹ JELLYSEERR  ðŸ”¹ðŸ”¹
  # One-stop-shop for downloading movies, shows, books instead of logging in to each individual app (Sonarr, Radarr, etc)
  seerr:
    image: ghcr.io/seerr-team/seerr:v3.0.1
    network_mode: "service:gluetun"
    init: true
    container_name: seerr
    environment:
      - PGID=0
      - PUID=0
      - TZ={{ timezone }}
      - NODE_EXTRA_CA_CERTS=/etc/ssl/certs/home-ca.crt
    volumes:
      - ./jellyseerr:/app/config
      - /etc/ssl/certs:/etc/ssl/certs:ro
    restart: unless-stopped
    labels:
      # Traefik
      - "traefik.docker.network=proxy"
      - "traefik.enable=true"
      - "traefik.http.routers.seerr.entrypoints=websecure"
      - "traefik.http.routers.seerr.rule=Host(`media.{{ domain }}`)"
      - "traefik.http.routers.seerr.tls=true"
      - "traefik.http.routers.seerr.tls.certresolver=stepca"
      - "traefik.http.services.seerr.loadbalancer.server.port=5055"
    dns:
      - 8.8.8.8
      - 1.1.1.1
      - 192.168.1.1
    networks:
      - default
      - proxy

networks:
  proxy:
    external: true
