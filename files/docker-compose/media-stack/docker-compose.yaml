---
services:
  gluetun:
    image: qmcgaw/gluetun:v3
    container_name: gluetun
    restart: unless-stopped
    cap_add:
      - NET_ADMIN
    devices:
      - /dev/net/tun:/dev/net/tun
    environment:
      - BLOCK_ADS=on
      - BLOCK_MALICIOUS=on 
      - BLOCK_SURVEILLANCE=on
      - DNS_UPDATE_PERIOD=24h
      - FREE_ONLY=off
      - TZ={{ timezone }}
      - UPDATER_PERIOD=24h
      # WIREGUARD CONFIG
      - VPN_SERVICE_PROVIDER=protonvpn
      - VPN_PORT_FORWARDING=on
      - VPN_PORT_FORWARDING_PROVIDER=protonvpn
      # - VPN_ENDPOINT_PORT=38038
      - VPN_TYPE=wireguard
      - WIREGUARD_PUBLIC_KEY={{ gluetun_wireguard_public_key }}
      - WIREGUARD_PRIVATE_KEY={{ gluetun_wireguard_private_key }}
      - WIREGUARD_ENDPOINT_IP={{ gluetun_wireguard_endpoint_ip }}
    # ports:
    #   - 8888:8888/tcp # HTTP proxy
    #   - 8388:8388/tcp # Shadowsocks
    #   - 8388:8388/udp # Shadowsocks
    volumes:
      - ./gluetun:/gluetun
    labels:
      # Treafik
      - "traefik.enable=true"
      - "traefik.docker.network=proxy"
      # Gluetun Built-in HTTP control server (API Endpoint)
      - "traefik.http.routers.gluetun.entrypoints=websecure"
      - "traefik.http.routers.gluetun.rule=Host(`gluetun.{{ domain }}`)"
      - "traefik.http.routers.gluetun.service=gluetun"
      - "traefik.http.routers.gluetun.tls=true"
      - "traefik.http.routers.gluetun.tls.certresolver=stepca"
      - "traefik.http.services.gluetun.loadbalancer.server.port=8000"
      # JELLYFIN
      - "traefik.http.routers.jellyfin.entrypoints=web"
      - "traefik.http.routers.jellyfin.rule=Host(`jellyfin.{{ domain }}`)"
      - "traefik.http.routers.jellyfin.service=jellyfin"
      - "traefik.http.services.jellyfin.loadbalancer.server.port=8096"
      # SEERR
      - "traefik.http.routers.seerr.entrypoints=websecure"
      - "traefik.http.routers.seerr.rule=Host(`media.{{ domain }}`)"
      - "traefik.http.routers.seerr.service=seerr"
      - "traefik.http.routers.seerr.tls=true"
      - "traefik.http.routers.seerr.tls.certresolver=stepca"
      - "traefik.http.services.seerr.loadbalancer.server.port=5055"
      # QUI
      - "traefik.http.routers.qui.entrypoints=websecure"
      - "traefik.http.routers.qui.rule=Host(`qui.{{ domain }}`)"
      - "traefik.http.routers.qui.service=qui"
      - "traefik.http.routers.qui.tls=true"
      - "traefik.http.routers.qui.tls.certresolver=stepca"
      - "traefik.http.services.qui.loadbalancer.server.port=7476"
      # QBITTORRENT
      - "traefik.http.routers.qbittorrent.entrypoints=websecure"
      - "traefik.http.routers.qbittorrent.rule=Host(`qbittorrent.{{ domain }}`)"
      - "traefik.http.routers.qbittorrent.service=qbittorrent"
      - "traefik.http.routers.qbittorrent.tls=true"
      - "traefik.http.routers.qbittorrent.tls.certresolver=stepca"
      - "traefik.http.services.qbittorrent.loadbalancer.server.port=8081"
      # PROWLARR
      - "traefik.http.routers.prowlarr.entrypoints=websecure"
      - "traefik.http.routers.prowlarr.rule=Host(`prowlarr.{{ domain }}`)"
      - "traefik.http.routers.prowlarr.service=prowlarr"
      - "traefik.http.routers.prowlarr.tls=true"
      - "traefik.http.routers.prowlarr.tls.certresolver=stepca"
      - "traefik.http.services.prowlarr.loadbalancer.server.port=9696"
      # SONARR
      - "traefik.http.routers.sonarr.entrypoints=websecure"
      - "traefik.http.routers.sonarr.rule=Host(`sonarr.{{ domain }}`)"
      - "traefik.http.routers.sonarr.service=sonarr"
      - "traefik.http.routers.sonarr.tls=true"
      - "traefik.http.routers.sonarr.tls.certresolver=stepca"
      - "traefik.http.services.sonarr.loadbalancer.server.port=8989"
      # RADARR
      - "traefik.http.routers.radarr.entrypoints=websecure"
      - "traefik.http.routers.radarr.rule=Host(`radarr.{{ domain }}`)"
      - "traefik.http.routers.radarr.service=radarr"
      - "traefik.http.routers.radarr.tls=true"
      - "traefik.http.routers.radarr.tls.certresolver=stepca"
      - "traefik.http.services.radarr.loadbalancer.server.port=7878"
      # LIDARR
      - "traefik.http.routers.lidarr.entrypoints=websecure"
      - "traefik.http.routers.lidarr.rule=Host(`lidarr.{{ domain }}`)"
      - "traefik.http.routers.lidarr.service=lidarr"
      - "traefik.http.routers.lidarr.tls=true"
      - "traefik.http.routers.lidarr.tls.certresolver=stepca"
      - "traefik.http.services.lidarr.loadbalancer.server.port=8686"
      # DISPATCHARR
      - "traefik.http.routers.dispatcharr.entrypoints=websecure"
      - "traefik.http.routers.dispatcharr.rule=Host(`dispatcharr.{{ domain }}`)"
      - "traefik.http.routers.dispatcharr.service=dispatcharr"
      - "traefik.http.routers.dispatcharr.tls=true"
      - "traefik.http.routers.dispatcharr.tls.certresolver=stepca"
      - "traefik.http.services.dispatcharr.loadbalancer.server.port=9191"
      # BAZARR
      - "traefik.http.routers.bazarr.entrypoints=websecure"
      - "traefik.http.routers.bazarr.rule=Host(`bazarr.{{ domain }}`)"
      - "traefik.http.routers.bazarr.service=bazarr"
      - "traefik.http.routers.bazarr.tls=true"
      - "traefik.http.routers.bazarr.tls.certresolver=stepca"
      - "traefik.http.services.bazarr.loadbalancer.server.port=6767"
      # PINCHFLAT
      - "traefik.http.routers.pinch.entrypoints=websecure"
      - "traefik.http.routers.pinch.rule=Host(`youtube.{{ domain }}`)"
      - "traefik.http.routers.pinch.service=pinch"
      - "traefik.http.routers.pinch.tls=true"
      - "traefik.http.routers.pinch.tls.certresolver=stepca"
      - "traefik.http.services.pinch.loadbalancer.server.port=8945"
      # # XTEVE
      # - "traefik.http.routers.xteve-01.entrypoints=web"
      # - "traefik.http.routers.xteve-01.rule=Host(`xteve-01.{{ domain }}`)"
      # - "traefik.http.routers.xteve-01.service=xteve-01"
      # - "traefik.http.services.xteve-01.loadbalancer.server.port=34400"
    networks:
      - proxy

  # ðŸ”¹ðŸ”¹ JELLYFIN  ðŸ”¹ðŸ”¹
  # Media player
  jellyfin:
    image: lscr.io/linuxserver/jellyfin:latest
    container_name: jellyfin
    network_mode: "service:gluetun"
    environment:
      - JELLYFIN_PublishedServerUrl=http://jellyfin.{{ domain }}
      - PGID=0
      - PUID=0
      - TZ={{ timezone }}
    volumes:
      - ./jellyfin/config:/config
      - ./jellyfin/cache:/cache
      - /mnt/media/disk-0/movies:/movies
      - /mnt/media/disk-0/tv:/tv
      - /mnt/media/disk-0/youtube:/youtube
      - /mnt/media/disk-0/music:/music
    devices:
      - "/dev/dri:/dev/dri"
    restart: 'unless-stopped'
    # ports:
    #   - "7359:7359/udp"  # Client Discovery

  # ðŸ”¹ðŸ”¹ JELLYSEERR  ðŸ”¹ðŸ”¹
  # One-stop-shop for downloading movies, shows, books instead of logging in to each individual app (Sonarr, Radarr, etc)
  seerr:
    image: ghcr.io/seerr-team/seerr:v3.0.1
    network_mode: "service:gluetun"
    restart: unless-stopped
    init: true
    container_name: seerr
    environment:
      - PGID=0
      - PUID=0
      - TZ={{ timezone }}
      - NODE_EXTRA_CA_CERTS=/etc/ssl/certs/home-ca.crt
    volumes:
      - ./jellyseerr:/app/config
      - /etc/ssl/certs:/etc/ssl/certs:ro

  # ðŸ”¹ðŸ”¹ QUI  ðŸ”¹ðŸ”¹
  # UI for Qbittorrent
  qui:
    image: ghcr.io/autobrr/qui:latest
    container_name: qui
    network_mode: "service:gluetun"
    restart: unless-stopped
    environment:
      - PGID=0
      - PUID=0
      - TZ={{ timezone }}
    volumes:
      - ./qui:/config

   # ðŸ”¹ðŸ”¹ QBITTORRENT  ðŸ”¹ðŸ”¹
  # Torrent client
  qbittorrent:
    image: lscr.io/linuxserver/qbittorrent:latest
    container_name: qbittorrent
    network_mode: "service:gluetun"
    restart: unless-stopped
    environment:
      - PGID=0
      - PUID=0
      - TZ={{ timezone }}
      - WEBUI_PORT=8081
    volumes:
      - ./qbittorrent:/config
      - /mnt/media/disk-1/downloads:/downloads

  # ðŸ”¹ðŸ”¹ PROWLARR  ðŸ”¹ðŸ”¹
  # With Prowlarr, the user gets Indexer Sync and seamless integration support with various PVR apps. In addition, with Prowlarr, the user can manage all Torrent trackers and Usenet Indexers from one place while providing support for automation with the search for and download content, irrespective of the content type.
  prowlarr:
    image: lscr.io/linuxserver/prowlarr:latest
    container_name: prowlarr
    network_mode: "service:gluetun"
    restart: unless-stopped
    environment:
      - PGID=0
      - PUID=0
      - TZ={{ timezone }}
    volumes:
      - ./prowlarr:/config

  # ðŸ”¹ðŸ”¹ SONARR  ðŸ”¹ðŸ”¹
  # Sonarr is a PVR for Usenet and BitTorrent users. It can monitor multiple RSS feeds for new episodes of your favorite shows and will grab, sort and rename them.
  sonarr:
    image: lscr.io/linuxserver/sonarr:latest
    container_name: sonarr
    network_mode: "service:gluetun"
    restart: unless-stopped
    environment:
      - PGID=0
      - PUID=0
      - TZ={{ timezone }}
    volumes:
      - ./sonarr:/config
      - /mnt/media/disk-0/tv:/tv
      - /mnt/media/disk-1/downloads:/downloads

  # ðŸ”¹ðŸ”¹ RADARR  ðŸ”¹ðŸ”¹
  # Radarr is similar to Sonarr but grabs movies instead of TV shows.
  radarr:
    image: lscr.io/linuxserver/radarr:latest
    container_name: radarr
    network_mode: "service:gluetun"
    restart: unless-stopped
    environment:
      - PGID=0
      - PUID=0
      - TZ={{ timezone }}
    volumes:
      - ./radarr:/config
      - /mnt/media/disk-0/movies:/movies
      - /mnt/media/disk-1/downloads:/downloads

  # ðŸ”¹ðŸ”¹ LIDARR  ðŸ”¹ðŸ”¹
  # Lidarr is a music collection manager for Usenet and BitTorrent users. It can monitor multiple RSS feeds for new albums and will grab, sort and rename them.
  lidarr:
    image: lscr.io/linuxserver/lidarr:latest
    container_name: lidarr
    network_mode: "service:gluetun"
    restart: unless-stopped
    environment:
      - PUID=0
      - PGID=0
      - TZ={{ timezone }}
    volumes:
      - ./lidarr:/config
      - /mnt/media/disk-0/music:/music
      - /mnt/media/disk-1/downloads:/downloads

  # ðŸ”¹ðŸ”¹ DISPATCHARR  ðŸ”¹ðŸ”¹
  # Dispatcharr is a tool for managing IPTV streams.
  dispatcharr:
    image: ghcr.io/dispatcharr/dispatcharr:latest
    container_name: dispatcharr
    network_mode: "service:gluetun"
    restart: unless-stopped
    volumes:
      - ./dispatcharr:/data
    environment:
      - DISPATCHARR_ENV=aio
      - REDIS_HOST=localhost
      - CELERY_BROKER_URL=redis://localhost:6379/0
      - DISPATCHARR_LOG_LEVEL=info

  # ðŸ”¹ðŸ”¹ BAZARR  ðŸ”¹ðŸ”¹
  # Bazarr is a companion application to Sonarr and Radarr that manages and downloads subtitles based on your requirements.
  bazarr:
    image: lscr.io/linuxserver/bazarr:latest
    container_name: bazarr
    network_mode: "service:gluetun"
    restart: unless-stopped
    environment:
      - UMASK_SET # Control permissions of files and directories created by Bazarr
      - PGID=0
      - PUID=0
      - TZ={{ timezone }}
    volumes:
      - ./bazarr:/config
      - /mnt/media/disk-0/tv:/tv
      - /mnt/media/disk-0/movies:/movies
      - /mnt/media/disk-1/downloads:/downloads

  # ðŸ”¹ðŸ”¹ PINCHFLAT  ðŸ”¹ðŸ”¹
  # Pinchflat is for tracking/downloading youtube videos
  pinchflat:
    image: ghcr.io/kieraneglin/pinchflat:latest
    container_name: pinchflat
    network_mode: "service:gluetun"
    restart: always
    environment:
      - PGID=0
      - PUID=0
      - TZ={{ timezone }}
    volumes:
      - ./pinchflat:/config
      - /mnt/media/disk-0/youtube:/downloads

  # # ðŸ”¹ðŸ”¹ XTEVE  ðŸ”¹ðŸ”¹
  # # XTEVE is a TV streaming server that allows you to stream your media to your TV.
  # xteve-01:
  #   image: senexcrenshaw/xteve:latest
  #   container_name: xteve-01
  #   network_mode: "service:gluetun"
  #   restart: unless-stopped
  #   environment:
  #     - TZ={{ timezone }}
  #   volumes:
  #     - ./xteve/xteve-01:/home/xteve/conf
  #     - ./xteve/xteve-01/tmp:/tmp/xteve:rw

networks:
  proxy:
    external: true
